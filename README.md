# OCCW报价与销售分析系统

一个专业的厨柜行业报价管理和销售数据分析平台，基于 Flask 构建，提供完整的PDF解析、Excel处理、销售分析和数据可视化功能。

## 🚀 功能特性

### 📊 销售分析核心功能
- **📈 完整销售数据分析**：Excel销售订单导入、转换、分析一体化解决方案
- **🔍 智能多维过滤**：支持金额阈值、销售人员、客户、日期范围、订单状态的灵活过滤
- **💰 金额区间分析**：报价单金额区间过滤（≤1000、1000-5000、5000-10000、≥10000、全部金额）
- **🔄 标准化数据转换**：自动转换订单状态（订单、报价单、已取消、已发送报价单）
- **👥 销售业绩统计**：销售员和客户转化率分析，支持汇总统计
- **📉 数据可视化**：Chart.js双Y轴图表，实时销售趋势和转化率分析
- **📋 销售人员对比**：多维度业绩对比（数量、金额、转化率）
- **📤 数据导出**：支持原始数据和转换数据的Excel导出

### 📋 报价管理功能
- **📄 PDF 报价单解析**：自动解析 PDF 文件中的产品信息，智能识别产品代码
- **💾 Excel 价格表管理**：OCCW 价格表的导入、管理和实时查询
- **🔗 SKU 映射管理**：灵活的产品编码映射系统，支持自定义规则
- **🌍 多语言支持**：完整的中文、英文、法文界面国际化
- **👤 用户权限管理**：管理员和普通用户权限分离，安全可靠

### 🛠️ 技术特性
- **⚡ 高性能处理**：基于 Pandas 的高效数据处理引擎
- **🎨 现代化界面**：Bootstrap 5 响应式设计，适配各种设备
- **🔄 实时数据同步**：AJAX 异步处理，流畅的用户体验
- **📁 智能文件管理**：临时文件自动管理和清理机制
- **🔒 数据安全**：完善的数据验证和错误处理机制

## 💻 技术栈

### 后端技术
- **🐍 框架**：Flask 2.3.3 - 轻量级Web框架
- **📊 数据处理**：Pandas 2.1.4, NumPy 1.24.3 - 高效数据分析
- **📁 文件处理**：PyPDF2 3.0.1, openpyxl 3.1.2 - PDF和Excel处理
- **📋 报告生成**：ReportLab 4.0.7, xlsxwriter 3.1.9 - 动态报告生成
- **🌐 部署**：Gunicorn 21.2.0 - 生产环境WSGI服务器

### 前端技术
- **🎨 UI框架**：Bootstrap 5.3 - 响应式界面设计
- **📈 图表库**：Chart.js 4.4 - 现代化数据可视化
- **⚡ 交互库**：jQuery 3.7 - DOM操作和AJAX
- **🎯 图标库**：Font Awesome 6.5 - 丰富的图标资源

## 安装和部署

### 本地开发

1. **克隆项目**
```bash
git clone <repository-url>
cd occw-utils-app
```

2. **安装依赖**
```bash
pip install -r requirements.txt
```

3. **运行应用**
```bash
python app.py
```

4. **访问应用**
打开浏览器访问 `http://localhost:5000`

### 生产部署

#### Render 部署
项目已配置 `render.yaml`，可直接部署到 Render 平台：

1. 连接 GitHub 仓库到 Render
2. 选择 "Web Service"
3. 使用提供的 `render.yaml` 配置
4. 自动部署完成

#### 其他平台
```bash
# 使用 Gunicorn 启动
gunicorn --config gunicorn.conf.py app:app
```

## 环境变量

| 变量名 | 说明 | 默认值 |
|--------|------|--------|
| `FLASK_ENV` | Flask 环境 | production |
| `SECRET_KEY` | 应用密钥 | 自动生成 |
| `ADMIN_PASSWORD` | 管理员密码 | admin123 |
| `PYTHON_VERSION` | Python 版本 | 3.11.6 |
| `FLASK_DEBUG` | 调试模式 | 0 |
| `DATABASE_URL` | 数据库连接 | sqlite:///occw_utils.db |

## 📖 使用指南

### 🔐 管理员功能

#### 1. 登录管理
- **用户名**：admin
- **密码**：admin123（可在环境变量中修改）

#### 2. 价格表管理
- 📥 **上传 OCCW 价格表**：支持.xlsx/.xls格式
- 🔗 **管理 SKU 映射关系**：自定义产品编码映射
- 📊 **查看价格统计信息**：实时价格数据统计

#### 3. 导入数据过滤设置
- 💰 **最小导入金额阈值**：过滤低于指定金额的数据
- 👥 **销售人员过滤**：多选销售人员，逗号分隔
- 🏢 **客户过滤**：指定客户范围
- 📅 **日期范围过滤**：设置开始和结束日期
- 📋 **订单状态过滤**：动态多选，自动提取数据中的状态

#### 4. 系统管理
- 🔑 **修改管理员密码**：安全设置
- ⚙️ **系统参数配置**：功能开关和参数调整
- 👤 **用户账户管理**：用户权限控制

### 📊 销售分析功能

#### 1. 数据导入与过滤
- 📤 **Excel文件上传**：支持.xlsx/.xls格式的销售订单数据
- 🔍 **智能多维过滤**：金额、销售人员、客户、日期、状态过滤
- 💰 **金额区间分析**：≤1000、1000-5000、5000-10000、≥10000、全部金额
- 🔄 **自动数据转换**：标准化处理原始数据

#### 2. 数据查看与管理
- 👁️ **原始数据查看**：排序、搜索、分页、导出功能
- 🔄 **转换数据查看**：标准化字段（订单金额、报价单金额、数量字段）
- 📤 **数据导出**：Excel格式导出，保持数据完整性
- 🗂️ **智能文件管理**：自动清理过期临时文件

#### 3. 业绩分析表格
- 👥 **销售员业绩分析**：
  - 订单数量、总报价数量
  - 订单金额、总报价金额  
  - 数量转化率、金额转化率
  - 支持汇总行显示全员统计
- 🏢 **客户订单分析**：客户转化率和订单统计
- ⏰ **时间区间筛选**：自定义日期范围分析
- 🔄 **多列排序**：灵活的数据排序功能

#### 4. 数据可视化图表
- 💰 **金额转化率分析**：双Y轴折线图（金额 + 转化率）
- 📊 **数量转化率分析**：双Y轴折线图（数量 + 转化率）
- 👥 **销售人员对比**：
  - 数量对比图表
  - 金额对比图表
  - 转化率对比图表
- 🔍 **交互功能**：
  - 按销售人员过滤
  - 时间周期切换（月/周）
  - 图表最大化显示

#### 5. 数据转换逻辑
- **📋 报价单**：订单金额=0，报价单金额=总计，订单数量=0，报价单数量=1
- **💼 销售订单**：订单金额=总计，报价单金额=总计，订单数量=1，报价单数量=1
- **❌ 已取消**：自动过滤掉此类数据
- **📨 已发送报价单**：订单金额=0，报价单金额=总计，订单数量=0，报价单数量=1

### 📋 报价单功能

#### 1. PDF 解析处理
- 📄 **PDF文件上传**：自动解析产品信息
- 🔍 **智能识别**：产品代码、数量、价格自动提取
- 📊 **生成报告**：Excel格式输出

#### 2. 手动创建报价
- ✏️ **产品信息录入**：手动输入产品详情
- 💰 **实时价格查询**：即时获取最新价格
- 📋 **报价单生成**：标准格式输出

## 文件结构

```
occw-utils-app/
├── app.py                 # 主应用文件
├── requirements.txt       # Python 依赖
├── render.yaml           # Render 部署配置
├── gunicorn.conf.py      # Gunicorn 配置
├── version.py            # 版本信息
├── translations.py       # 多语言翻译
├── templates/            # HTML 模板
│   ├── base.html
│   └── index.html
├── static/               # 静态文件
├── upload/               # 上传文件目录
├── data/                 # 数据文件目录
└── uploads/              # 用户上传目录
```

## 开发说明

### 添加新功能
1. 在 `app.py` 中添加路由和逻辑
2. 在 `templates/index.html` 中添加前端界面
3. 在 `translations.py` 中添加多语言支持
4. 更新 `requirements.txt`（如需要）

### 多语言支持
- 支持语言：中文、英文、法文
- 翻译文件：`translations.py`
- 切换方式：URL 参数 `?lang=zh/en/fr`

### 数据存储
- 使用 SQLite 数据库
- 文件存储：JSON 格式
- 备份建议：定期备份 `data/` 目录

## 🔄 版本更新

### v3.0.0 (2024-08-03) - 销售分析系统重大升级
- ✨ **全面销售数据分析系统**：完整的Excel导入、转换、分析功能
- 🔍 **智能过滤系统升级**：支持金额区间、多维度过滤
- 📊 **数据可视化增强**：Chart.js双Y轴图表，销售人员对比分析
- 🌍 **完整多语言化**：系统名称和界面元素全面国际化
- 🐛 **重要Bug修复**：金额过滤器、图表显示、数据转换等问题修复
- ⚡ **性能优化**：数据处理性能提升，界面响应优化

### 历史版本
- **v2.7.0** (2024-07-29): 价格表导入优化
- **v2.6.0** (2024-07-29): PDF上传错误修复  
- **v2.5.0** (2024-07-29): 界面统一化
- **v2.0.0** (2024-07-27): SKU映射管理重写
- **v1.0.0** (2024-01-01): 初始版本发布

## 📞 技术支持

### 联系方式
- **📧 邮箱支持**：info@oppeincabinet.ca
- **📱 电话支持**：+1 (778) 532-6233
- **⏰ 服务时间**：周一至周五 9:00-17:00 (PST)

### 使用建议
- 💡 **数据格式**：使用标准的Excel模板确保最佳解析效果
- 🔍 **问题排查**：查看帮助文档的故障排除部分
- 💾 **数据备份**：定期备份重要的价格表和映射数据
- 🆕 **版本更新**：关注版本更新获取最新功能和修复

## 📄 许可证

本项目仅供 OPPEIN CABINET 内部使用。

---

**系统版本**: v3.0.0  
**最后更新**: 2024-08-03  
**开发团队**: OCCW系统开发团队 